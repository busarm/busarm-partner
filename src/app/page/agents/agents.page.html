<ion-header>
    <ion-toolbar color="primary">
        <ion-buttons slot="start">
            <ion-back-button defaultHref="/home/account"> </ion-back-button>
        </ion-buttons>
        <ion-title>{{strings.getString("my_agents_txt")}}</ion-title>
        <ion-buttons slot="end">
            <ion-button (click)="refreshAgentsView()">
                <ion-icon slot="icon-only" class="secondary" name="refresh">
                </ion-icon>
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
    <ion-searchbar
            showCancelButton="focus"
            placeholder="{{strings.getString('agent_search_hint')}}"
            debounce="500"
            (input)="onInput($event)"
            (search)="onInput($event,true)"
            (clear)="onClear($event)"
            (cancel)="onClear($event)"
            [animated]="true"
            [(ngModel)]="searchText">
    </ion-searchbar>
</ion-header>
<ion-content class="ion-padding">

    <!--Refresher -->
    <ion-refresher
            slot="fixed"
            [pullMin]="80"
            (ionRefresh)="refreshAgentsView($event)" 
            slot="fixed">
        <ion-refresher-content
                [pullingText]="strings.getString('pull_refresh_txt')"
                [refreshingText]="strings.getString('refreshing_txt')"
                [refreshingSpinner]="'circles'">
        </ion-refresher-content>
    </ion-refresher>

    <!--Loading view - Show if Buses hasn't been loaded yet-->
    <div class="loader cell" *ngIf="currentAgents==null">
        <ion-img [src]="assets.getPath('loading_page')"> </ion-img>
        <ion-label class="cell-content">{{strings.getString('loading_txt')}}</ion-label>
    </div>

    <!--No User view -->
    <div class="loader cell" *ngIf="currentAgents!=null && currentAgents.length <= 0">
        <img src="{{assets.getPath('not_found')}}"/>
        <ion-label class="cell-content">{{strings.getString('not_found_txt')}}</ion-label>
    </div>

    <ion-grid *ngIf="currentAgents!=null && currentAgents.length > 0">
        <ion-row wrap>
            <ion-col size="12" size-md="6" *ngFor="let agent of currentAgents; let i = index" [attr.index]="i">
                <ion-card>
                    <ion-card-header>
                        <ion-row>
                            <ion-col size="6" class="cell cell-flex cell-flex-left">
                                <ion-toggle *ngIf="userInfo.agent_id != agent.agent_id && !agent.is_partner && !(agent.is_admin && userInfo.is_admin && !userInfo.is_partner)"
                                            color="success"
                                            [checked] = "agent.is_active"
                                            (ionChange)="toggleAgent(agent, !agent.is_active)">
                                </ion-toggle>
                            </ion-col>
                            <ion-col size="6" class="cell cell-flex cell-flex-right">
                                <ion-label *ngIf="agent.is_admin" class="status-ok small-text">Admin</ion-label>
                            </ion-col>
                        </ion-row>
                    </ion-card-header>
                    <ion-card-content>
                        <ion-row>
                            <ion-col size="12" class="cell cell-center cell-flex cell-flex-left">
                                <ion-row>
                                    <ion-col size="12">
                                        <ion-label class="cell-title">{{agent.name}}</ion-label>
                                    </ion-col>
                                    <ion-col size="12">
                                        <ion-label class="cell-content">{{agent.email}}</ion-label>
                                    </ion-col>
                                    <ion-col size="12">
                                        <ion-label class="cell-sub">{{agent.dial_code}}{{agent.phone}}</ion-label>
                                    </ion-col>
                                    <ion-col size="12" *ngIf="agent.is_active && userInfo.agent_id != agent.agent_id && !agent.is_partner && !(agent.is_admin && userInfo.is_admin && !userInfo.is_partner)" class="cell cell-center cell-flex cell-flex-left ion-no-padding">
                                        <ion-button color="dark" (click)="confirmDeleteAgent(agent)">
                                            <ion-icon color="danger" name="remove-circle" slot="start"> </ion-icon>
                                            {{strings.getString("delete_txt")}}
                                        </ion-button>
                                    </ion-col>
                                    <ion-col size="12" *ngIf="agent.is_active && !agent.is_admin" class="cell cell-center  cell-flex cell-flex-left">
                                        <ion-button color="tertiary" (click)="confirmMakeAdmin(agent)">
                                            {{strings.getString("make_admin_title_txt")}}
                                        </ion-button>
                                    </ion-col>
                                    <ion-col size="12" *ngIf="agent.is_active && agent.is_admin && userInfo.agent_id != agent.agent_id && !agent.is_partner && !(agent.is_admin && userInfo.is_admin && !userInfo.is_partner)" class="cell cell-center  cell-flex cell-flex-left ion-no-padding">
                                        <ion-button color="danger" (click)="confirmRemoveAdmin(agent)">
                                            {{strings.getString("remove_admin_title_txt")}}
                                        </ion-button>
                                    </ion-col>
                                    <ion-col size="12" *ngIf="agent.is_active" class="cell cell-center  cell-flex cell-flex-left ion-no-padding">
                                        <ion-button color="primary" (click)="confirmForgotPassword(agent)">
                                            {{strings.getString("forgot_password_title_txt")}}
                                        </ion-button>
                                    </ion-col>
                                </ion-row>
                            </ion-col>
                        </ion-row>
                    </ion-card-content>
                </ion-card>
            </ion-col>
        </ion-row>
    </ion-grid>
    <br><br><br>
    <ion-fab vertical="bottom" horizontal="end" slot="fixed">
        <ion-fab-button (click)="showAddAgent()">
            <ion-icon name="add"> </ion-icon>
        </ion-fab-button>
    </ion-fab>
</ion-content>
